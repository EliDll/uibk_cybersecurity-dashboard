<mat-card>
  <mat-card-title> Current release Pentest Findings </mat-card-title>
  <mat-card-content *ngIf="findings$ | async; let findings">
    <table mat-table [dataSource]="findings" class="mat-elevation-z8">
      <ng-container matColumnDef="severity">
        <th mat-header-cell *matHeaderCellDef>Severity</th>
        <td mat-cell *matCellDef="let entry">
          <p [class]="'entry-' + entry.cat.toLowerCase()">
            {{ entry.severity }}
          </p>
        </td>
      </ng-container>

      <ng-container matColumnDef="risks">
        <th mat-header-cell *matHeaderCellDef>Associated OWASP risks</th>
        <td mat-cell *matCellDef="let entry">
          <div class="risk-cell-container">
            <div *ngFor="let risk of entry.risks">
              <a [href]="risk.url"> {{ risk.id }}</a>
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let entry">
          This is a brief description of the potential threat
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let entry">
          <p class="state-resolved" *ngIf="entry.ignored && entry.resolvedDate">
            RESOLVED MANUALLY
          </p>
          <p
            class="state-mitigated"
            *ngIf="!entry.ignored && entry.resolvedDate"
          >
            MITIGATED
          </p>
          <p class="state-open" *ngIf="!entry.resolvedDate">OPEN</p>
        </td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>
          <div>
            <mat-icon
              *ngIf="isDateFiltered$ | async"
              matTooltip="Reset Snapshot Date to resolve Pentest findings."
              [matTooltipDisabled]="(isDateFiltered$ | async) === false"
              class="warn-icon"
              >warning</mat-icon
            >
            Actions
          </div>
        </th>
        <td mat-cell *matCellDef="let entry">
          <div *ngIf="!entry.resolvedDate">
            <button
              *ngIf="developmentData$ | async; let data"
              [disabled]="isDateFiltered$ | async"
              mat-raised-button
              matTooltip="Reset Snapshot Date to resolve this pentest finding."
              [matTooltipDisabled]="(isDateFiltered$ | async) === false"
              color="primary"
              (click)="onResolveClick(entry.ogIndex, data)"
            >
              Mark as resolved
            </button>
          </div>
        </td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="[
          'description',
          'severity',
          'risks',
          'status',
          'actions'
        ]"
      ></tr>
      <tr
        mat-row
        *matRowDef="
          let row;
          columns: ['description', 'severity', 'risks', 'status', 'actions']
        "
      ></tr>
    </table>
  </mat-card-content>
</mat-card>
